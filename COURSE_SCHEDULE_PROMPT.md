# Amazing Marvin 課程排程指令詞（優化版）

> 適用於 Amazing Marvin Remote MCP
> 時區：Asia/Taipei
> 目標：建立到 2025-12-30 的所有課程事件

---

## 📋 指令詞（直接複製貼上給 Claude）

你現在要用「Amazing Marvin MCP」直接在 Marvin 建立「有開始時間的 Event（非全天）」；每門課是一個連續時段，不拆段。請先做前置檢查，再批次建立每週課程，從「今天之後的下一個對應週幾」開始，週週建立到（含）2025-12-30。時區一律 Asia/Taipei。不要使用 labels 或 categories。

### [前置檢查（很重要）]

1. **檢查可用工具清單**，確認存在可以建立事件的函式：
   - 優先使用：`create_event(title, start, duration_min, all_day, notes?, cal_id?)`
   - 必須支援：`start`（開始時間）和 `duration_min`（持續分鐘數）參數

2. **若找不到 create_event**（或等價、可帶 start 與 duration 的事件建立工具）：
   - ❌ 立刻停止並回報「缺少可建立 Event 的 MCP 函式」
   - ⚠️ **不要用 create_task 代替**（Task 沒有開始時間）

3. **驗證參數格式**：
   ```javascript
   // 正確的參數格式範例
   {
     title: "投資學",
     start: "2025-10-09 18:25",  // YYYY-MM-DD HH:MM (台北時間)
     duration_min: 165,           // 分鐘數
     all_day: false,              // 非全天
     notes: "",                   // 選填
     cal_id: ""                   // 選填（讓 Marvin 自動處理）
   }
   ```

### [建立規則]

- **每一筆課程都建立為一個「Event」**：
  - `all_day = false`（非全天事件）
  - `start = "YYYY-MM-DD HH:MM"`（台北時間，24 小時制）
  - `duration_min = 連續時段的總分鐘數`（見下表）
  - `notes` 可空
  - `cal_id` 可留空（讓 Marvin 依現有日曆連線設定處理）

- **日期計算規則**：
  1. 以今天為基準，對每一門課找出「今天之後的下一個對應星期」作為第一個日期
  2. 以 7 天為步進，逐週建立，直到（含）2025-12-30
  3. 僅建立「起始日期 ≤ 2025-12-30」的實例

- **重要**：不要把同一門課拆成多段；每條只建立一個連續時段的事件

### [每週固定課表（已合併為單一連續時段）]

**週一：**
- 財務管理 `18:25–21:10`（165 分鐘）

**週二：**
- 組織變革 `18:25–20:10`（105 分鐘）
- 國際財務管理 `20:20–22:05`（105 分鐘）

**週三：**
- 管理數學（遠端）`10:10–12:00`（110 分鐘）
- 人力資源管理 `18:25–20:10`（105 分鐘）
- 商務英文溝通 `20:20–22:05`（105 分鐘）

**週四：**
- 投資學 `18:25–21:10`（165 分鐘）

**週五：**
- 統計學 `18:25–21:10`（165 分鐘）

**週六：**
- 統計學 `08:10–10:00`（110 分鐘）

### [執行步驟（請逐步且明確回報）]

**步驟 1：前置驗證**
- 回報：是否找到 `create_event`（或等價）工具
- 若無，停止並回報

**步驟 2：計算日期**
- 計算每一門課從下一個對應星期起到 2025-12-30 的所有日期（Asia/Taipei）
- 回報預計建立的總事件數量

**步驟 3：分批建立（重要）**
- ⚠️ **採用分批策略**：每批建立 15-20 個事件
- 每批之間間隔 2-3 秒，避免 CouchDB rate limit
- 建立順序建議：按日期順序（最近的先建立）

**步驟 4：錯誤處理**
- 若遇到以下錯誤，請記錄並繼續：
  - `CouchDB error: 429` → Rate limit，等待 5 秒後重試
  - `CouchDB error: 404` → 跳過此事件，記錄到失敗清單
  - `KV limit exceeded` → 停止並回報已完成數量
- 若連續失敗 5 次，暫停並詢問是否繼續

**步驟 5：進度回報**
- 每完成一批（15-20 個）回報一次進度
- 格式：`已完成 X/總數 (Y%)`

**步驟 6：最終總結**
- 總建立數量（各課程分別多少筆）
- 成功/失敗統計
- 取 5 筆未來最近的事件樣本，列出：
  - `title`
  - `start`（本地時間）
  - `duration_min`
- 若有任何建立失敗或被拒絕，列出：
  - 錯誤訊息
  - 對應課程項目
  - 失敗的日期

### [預期結果]

**成功指標：**
- ✅ 所有課程從下週開始到 2025-12-30 都有對應的 Event
- ✅ 每個 Event 有正確的開始時間和持續時間
- ✅ Marvin Calendar Sync 會自動同步到 Outlook/BusyCal（若已設定）

**總事件數預估：**
- 週一：1 門課
- 週二：2 門課
- 週三：3 門課
- 週四：1 門課
- 週五：1 門課
- 週六：1 門課
- **每週共：9 門課**
- **預估週數：約 13 週**
- **總計：約 117 個事件**

---

## 📌 使用說明

1. **複製整個「指令詞」區塊**（從「你現在要用...」開始）
2. **貼到 Claude 對話中**
3. **等待 Claude 執行**
4. **檢查建立結果**

## ⚠️ 注意事項

- **首次使用建議**：先測試建立 1-2 週的課程，確認無誤後再建立全部
- **CouchDB 限制**：若遇到 rate limit，Claude 會自動分批處理
- **日曆同步**：確保 Marvin 的 Calendar Sync 已設定 Events 雙向同步
- **時區**：所有時間都是台北時間（Asia/Taipei）

## 🔍 疑難排解

**Q: Claude 回報「找不到 create_event」？**
A: 檢查 MCP 連接器狀態，確認使用的是最新版本的 Amazing Marvin Remote MCP

**Q: 部分事件建立失敗？**
A: 檢查錯誤訊息，可能是：
- CouchDB rate limit（等待後重試）
- 日期格式錯誤（檢查計算邏輯）
- CouchDB 認證問題（檢查環境變數）

**Q: 事件沒有同步到 Outlook？**
A: 檢查 Marvin Calendar Sync 設定：
- Settings → Calendar Sync
- 確認有 Events 的雙向同步設定
- 檢查同步狀態

---

**版本：** v2.0 (優化版)
**更新日期：** 2025-09-30
**相容 MCP 版本：** Amazing Marvin Remote MCP v1.0+
